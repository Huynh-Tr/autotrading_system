<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Trading System Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .profit {
            color: #28a745;
        }
        
        .loss {
            color: #dc3545;
        }
        
        .status-running {
            color: #28a745;
        }
        
        .status-stopped {
            color: #dc3545;
        }
        
        .portfolio-chart {
            height: 300px;
        }
        
        .table-responsive {
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line me-2"></i>
                Auto Trading System
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-circle status-running me-1"></i>
                    <span id="system-status">Running</span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Portfolio Overview -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="card-body">
                        <h5 class="card-title">Portfolio Value</h5>
                        <h3 class="card-text" id="portfolio-value">$105,000</h3>
                        <small class="text-light">+$5,000 (5.0%)</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="card-body">
                        <h5 class="card-title">Cash</h5>
                        <h3 class="card-text" id="cash-value">$50,000</h3>
                        <small class="text-light">Available for trading</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="card-body">
                        <h5 class="card-title">Daily P&L</h5>
                        <h3 class="card-text profit" id="daily-pnl">+$1,250</h3>
                        <small class="text-light">Today's performance</small>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card">
                    <div class="card-body">
                        <h5 class="card-title">Total Trades</h5>
                        <h3 class="card-text" id="total-trades">25</h3>
                        <small class="text-light">Win rate: 65%</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts and Tables -->
        <div class="row">
            <!-- Portfolio Performance Chart -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-area me-2"></i>
                            Portfolio Performance
                        </h5>
                    </div>
                    <div class="card-body">
                        <canvas id="portfolioChart" class="portfolio-chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Performance Metrics
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center mb-3">
                                    <h6>Sharpe Ratio</h6>
                                    <h4 class="profit" id="sharpe-ratio">1.2</h4>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center mb-3">
                                    <h6>Max Drawdown</h6>
                                    <h4 class="loss" id="max-drawdown">-8.0%</h4>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center mb-3">
                                    <h6>Volatility</h6>
                                    <h4 id="volatility">15.0%</h4>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center mb-3">
                                    <h6>Win Rate</h6>
                                    <h4 class="profit" id="win-rate">65%</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Positions and Trades -->
        <div class="row mt-4">
            <!-- Current Positions -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-briefcase me-2"></i>
                            Current Positions
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Quantity</th>
                                        <th>Entry Price</th>
                                        <th>Current Price</th>
                                        <th>P&L</th>
                                    </tr>
                                </thead>
                                <tbody id="positions-table">
                                    <!-- Positions will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Trades -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-exchange-alt me-2"></i>
                            Recent Trades
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Symbol</th>
                                        <th>Side</th>
                                        <th>Quantity</th>
                                        <th>Price</th>
                                    </tr>
                                </thead>
                                <tbody id="trades-table">
                                    <!-- Trades will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
            setInterval(loadDashboardData, 30000); // Refresh every 30 seconds
        });

        function loadDashboardData() {
            // Load portfolio data
            fetch('/api/portfolio')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('portfolio-value').textContent = `$${data.total_value.toLocaleString()}`;
                    document.getElementById('cash-value').textContent = `$${data.cash.toLocaleString()}`;
                    document.getElementById('daily-pnl').textContent = `$${data.daily_pnl.toLocaleString()}`;
                    document.getElementById('daily-pnl').className = data.daily_pnl >= 0 ? 'card-text profit' : 'card-text loss';
                    
                    updatePositionsTable(data.positions);
                });

            // Load performance data
            fetch('/api/performance')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('sharpe-ratio').textContent = data.sharpe_ratio.toFixed(1);
                    document.getElementById('max-drawdown').textContent = `${(data.max_drawdown * 100).toFixed(1)}%`;
                    document.getElementById('volatility').textContent = `${(data.volatility * 100).toFixed(1)}%`;
                    document.getElementById('win-rate').textContent = `${(data.win_rate * 100).toFixed(0)}%`;
                    document.getElementById('total-trades').textContent = data.total_trades;
                });

            // Load trades
            fetch('/api/trades')
                .then(response => response.json())
                .then(data => {
                    updateTradesTable(data);
                });

            // Load system status
            fetch('/api/system_status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('system-status').textContent = data.status.charAt(0).toUpperCase() + data.status.slice(1);
                });
        }

        function updatePositionsTable(positions) {
            const tbody = document.getElementById('positions-table');
            tbody.innerHTML = '';

            positions.forEach(position => {
                const row = document.createElement('tr');
                const pnlClass = position.pnl >= 0 ? 'profit' : 'loss';
                
                row.innerHTML = `
                    <td><strong>${position.symbol}</strong></td>
                    <td>${position.quantity}</td>
                    <td>$${position.entry_price.toFixed(2)}</td>
                    <td>$${position.current_price.toFixed(2)}</td>
                    <td class="${pnlClass}">$${position.pnl.toFixed(2)} (${position.pnl_pct.toFixed(2)}%)</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateTradesTable(trades) {
            const tbody = document.getElementById('trades-table');
            tbody.innerHTML = '';

            trades.forEach(trade => {
                const row = document.createElement('tr');
                const sideClass = trade.side === 'buy' ? 'text-success' : 'text-danger';
                
                row.innerHTML = `
                    <td>${trade.timestamp}</td>
                    <td><strong>${trade.symbol}</strong></td>
                    <td class="${sideClass}">${trade.side.toUpperCase()}</td>
                    <td>${trade.quantity}</td>
                    <td>$${trade.price.toFixed(2)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize portfolio chart
        const ctx = document.getElementById('portfolioChart').getContext('2d');
        const portfolioChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                datasets: [{
                    label: 'Portfolio Value',
                    data: [100000, 102000, 98000, 105000, 108000, 105000],
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    tension: 0.1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            callback: function(value) {
                                return '$' + value.toLocaleString();
                            }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>
</body>
</html> 